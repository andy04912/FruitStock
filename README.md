# ğŸ æ°´æœè­‰äº¤æ‰€ PRO (Fruit Stock Exchange System)

é€™æ˜¯ä¸€å€‹çµåˆ **AI ç”Ÿæˆå…§å®¹** èˆ‡ **å³æ™‚æ¨¡æ“¬å¸‚å ´** çš„è‚¡ç¥¨äº¤æ˜“éŠæˆ²ç³»çµ±ã€‚
ç³»çµ±é€éè¤‡é›œçš„æ¼”ç®—æ³•æ¨¡æ“¬çœŸå¯¦å¸‚å ´çš„æ³¢å‹•ï¼Œä¸¦åˆ©ç”¨ Google Gemini AI å‹•æ…‹ç”Ÿæˆè²¡ç¶“æ–°èã€å°ˆå®¶é æ¸¬èˆ‡æ–°å…¬å¸ IPOã€‚

---

## ğŸ› ï¸ æŠ€è¡“æ¶æ§‹ (Tech Stack)

### Backend (å¾Œç«¯)
- **Framework**: Python FastAPI (Async)
- **Database**: PostgreSQL (SQLModel ORM)
- **Cache / IPC**: Redis (ç”¨æ–¼ Pub/Sub å³æ™‚è¡Œæƒ…å»£æ’­)
- **AI**: Google Gemini Pro/Flash API
- **Scheduler**: APScheduler (è™•ç†é€±ä¸€ IPOã€å®šæ™‚ä»»å‹™)

### Frontend (å‰ç«¯)
- **Framework**: React 18 (Vite)
- **UI Lib**: TailwindCSS, Shadcn/UI, Lucide Icons
- **Charts**: Lightweight-Charts (TradingView)
- **State**: Context API + WebSocket (useSocket)

### DevOps
- **Docker**: å®Œæ•´å®¹å™¨åŒ–éƒ¨ç½² (Backend, Frontend-Nginx, Postgres, Redis)
- **Nginx**: åå‘ä»£ç†èˆ‡éœæ…‹è³‡æºæœå‹™

---

## âš™ï¸ æ ¸å¿ƒæ©Ÿåˆ¶è©³è§£ (Core Mechanics)


### 1. ğŸ“ˆ å¸‚å ´å¼•æ“ (Market Engine Mechanics)

ç³»çµ±é€éç‰©ç†æ¨¡æ“¬è¨ˆç®—æ¯ç§’çš„åƒ¹æ ¼è®Šå‹•ï¼Œå…¬å¼å¦‚ä¸‹ï¼š

> `Price Change % = RegimeBias + BrownianNoise + DynamicGravity + EventImpact + Sniper`

#### A. å„å¸‚å ´ç¨ç«‹ç‹€æ…‹ (Independent Market Regimes)

**ä¸‰å¤§å¸‚å ´å„è‡ªæ“æœ‰ç¨ç«‹çš„å¸‚å ´ç‹€æ…‹**ï¼Œæ°´æœå¯èƒ½åœ¨ç‰›å¸‚æ™‚ï¼Œè‚‰é¡åŒæ™‚å´©ç›¤ï¼š

| å¸‚å ´ | ç‰¹æ€§ | èªªæ˜ |
|---|---|---|
| ğŸ **æ°´æœ (FRUIT)** | æ¨™æº–æ³¢å‹• | æœ€ç©©å®šçš„äº¤æ˜“æ¨™çš„ |
| ğŸ¥© **è‚‰é¡ (MEAT)** | æ³¢å‹• Ã—1.3 | å°å¸‚å ´æƒ…ç·’æœ€æ•æ„Ÿ |
| ğŸ¥” **æ ¹è– (ROOT)** | æ³¢å‹• Ã—0.4 | ç©©å®šé…æ¯ï¼Œé¿éšªé¦–é¸ |

#### B. å››ç¨®å¸‚å ´é«”åˆ¶ (Market Regimes)

| ç‹€æ…‹ | æ³¢å‹•å¹…åº¦/åˆ†é˜ | æ–¹å‘ | æŒçºŒæ™‚é–“ |
|---|---|---|---|
| **å¹³ç©© (NORMAL)** | Â±6% | éš¨æ©Ÿ | 2-15 åˆ†é˜ |
| **ç‰›å¸‚ (BOOM)** ğŸš€ | Â±9% | â†— å‘ä¸Šåæ–œ | 0.5-5 åˆ†é˜ |
| **å´©ç›¤ (CRASH)** ğŸ“‰ | Â±12% | â†˜ å‘ä¸‹åæ–œ | 0.5-4 åˆ†é˜ |
| **æ··äº‚ (CHAOS)** ğŸŒªï¸ | Â±24% | âš¡ ç„¡æ–¹å‘ | 0.5-3 åˆ†é˜ |

> **ä¸å¯é æ¸¬è¨­è¨ˆ**ï¼šæ¯ç¨®ç‹€æ…‹çš„æŒçºŒæ™‚é–“ç¯„åœæ¥µå¤§ï¼Œç©å®¶ç„¡æ³•è¨ˆæ™‚å¥—åˆ©ã€‚

#### C. åŸºæº–åƒ¹éš¨æ©Ÿæ¼«æ­¥ (Base Price Random Walk)

å¸‚å ´ä¸å†æ˜¯ã€Œé‹¸é½’ç‹€ã€çš„ç„¡èŠéœ‡ç›ªï¼š
*   **è¶¨å‹¢å½¢æˆ**ï¼šåŸºæº–åƒ¹æ¯ç§’ Â±0.03% éš¨æ©Ÿæ¼‚ç§»ï¼Œå½¢æˆé•·æœŸç‰›/ç†Šè¶¨å‹¢ã€‚
*   **è¶¨å‹¢åè½‰**ï¼šæ¼‚ç§»æ–¹å‘å®Œå…¨éš¨æ©Ÿï¼Œè¶¨å‹¢å¯èƒ½éš¨æ™‚åè½‰ã€‚
*   **æ•ˆæœ**ï¼šè‚¡åƒ¹å¯ä»¥å¾ $100 æ¼²åˆ° $200ï¼Œä¹Ÿå¯èƒ½è·Œåˆ° $50ã€‚

#### D. å‹•æ…‹é‡åŠ› (Dynamic Gravity)

*   **35% ä»¥å…§**ï¼šè‚¡åƒ¹è‡ªç”±ç™¼å±•ï¼Œä¸å—æ‹‰å›ã€‚
*   **35%-60%**ï¼šè¼•å¾®å¼•åŠ›æ‹‰å›ï¼ˆ-0.5%/ç§’ï¼‰ã€‚
*   **60% ä»¥ä¸Š**ï¼šå¼·åŠ›å¼•åŠ›æ‹‰å›ï¼ˆ-1.5%/ç§’ï¼‰ã€‚

#### E. çªç ´æ©Ÿåˆ¶ (Breakthrough)

åœ¨ç‰¹å®šæ¢ä»¶ä¸‹ï¼Œ**é‡åŠ›æš«æ™‚æ¶ˆå¤±**ï¼Œè‚¡åƒ¹å¯ä»¥æš´è¡ï¼š
*   **CHAOS ç‹€æ…‹**ï¼šè©²å¸‚å ´å®Œå…¨ç„¡é‡åŠ›ã€‚
*   **éš¨æ©Ÿçªç ´**ï¼šæ¯ç§’ 1% æ©Ÿç‡è§¸ç™¼ç„¡é‡åŠ›ç‹€æ…‹ã€‚
*   **æ•ˆæœ**ï¼šå¶çˆ¾æœƒå‡ºç¾ Â±50% ä»¥ä¸Šçš„æ¥µç«¯è¡Œæƒ…ã€‚

#### F. ç‹™æ“Šæ‰‹æ•ˆæœ (Sniper)

*   **è§¸ç™¼æ©Ÿç‡**ï¼š0.04%/ç§’ï¼ˆç´„æ¯ 40 åˆ†é˜ä¸€æ¬¡ï¼‰
*   **æ•ˆæœ**ï¼šç¬é–“ Â±2%~4% çš„é–ƒå´©æˆ–æš´æ¼²
*   **è¨Šæ¯**ï¼š`[Market] ğŸ¯ Sniper hit Apple: +3.0%`

### 2. ğŸ¤– AI å°ˆå®¶é æ¸¬ç³»çµ± (Guru System)

*   **äº”å¤§æ€§æ ¼å°ˆå®¶**ï¼š
    *   ğŸº **è¯çˆ¾è¡—ä¹‹ç‹¼** (æ¿€é€²å¤šé ­)
    *   ğŸ”® **æ°´æ™¶çƒå©†å©†** (ç„å­¸ç©ºé ­)
    *   ğŸ¤– **AI é‡åŒ–æ©Ÿå™¨äºº** (æ•¸æ“šæµ)
    *   ğŸ‘´ **ç©©å¥è€ç‹** (ä¿å®ˆæ´¾)
    *   ğŸ”— **å€å¡Šéˆä¿¡ä»°è€…** (ç§‘æŠ€ç‹‚ç†±)
*   **è‡ªæˆ‘å¯¦ç¾é è¨€ (Self-Fulfilling Prophecy)**ï¼š
    *   ç•¶å°ˆå®¶ç™¼å¸ƒé æ¸¬ (Bull/Bear) æ™‚ï¼Œæœƒç”¢ç”Ÿå¾®å¹…çš„ã€Œå°ˆå®¶æ¼‚ç§» (Guru Drift)ã€åŠ›é“ï¼Œæ¨å‹•è‚¡åƒ¹å¾€é æ¸¬æ–¹å‘ç§»å‹•ã€‚
    *   **å‘½ä¸­çå‹µ**ï¼šè‹¥è‚¡åƒ¹çœŸçš„é”åˆ°ç›®æ¨™åƒ¹ï¼ŒAI æœƒç”Ÿæˆã€Œå°ˆå®¶ç¥æº–é è¨€ã€çš„æ–°èï¼Œä¸¦å°è‚¡åƒ¹é€ æˆäºŒæ¬¡è¡æ“Šã€‚

### 3. ğŸ“‰ ç ´ç”¢èˆ‡é‡çµ„ (Bankruptcy & Rebrand)

*   **è§¸ç™¼æ¢ä»¶**ï¼šç•¶è‚¡åƒ¹ä½æ–¼ **$0.05** æ™‚ï¼Œå…¬å¸å®£å‘Šç ´ç”¢ã€‚
*   **å¾Œæœ**ï¼š
    *   æ‰€æœ‰æŒæœ‰è©²è‚¡ç¥¨çš„ç©å®¶ï¼ŒæŒå€‰æ­¸é›¶ (å£ç´™)ã€‚
    *   **AI é‡çµ„**ï¼šç³»çµ±ç«‹å³å‘¼å« Gemini AIï¼Œç”Ÿæˆä¸€å®¶å…¨æ–°çš„å…¬å¸ (åç¨±ã€ä»£è™Ÿ)ï¼Œä¸¦åœ¨åŸåƒ¹ä½é™„è¿‘é‡æ–°ä¸Šå¸‚ (Re-IPO)ã€‚

### 4. ğŸ‰ æ–°è‚¡ä¸Šå¸‚ (Weekly IPO)

*   **è§¸ç™¼æ™‚é–“**ï¼šæ¯é€±ä¸€æ—©ä¸Š 9:00ã€‚
*   **æ©Ÿç‡**ï¼š5% æ©Ÿç‡è§¸ç™¼ã€‚
*   **æµç¨‹**ï¼šAI ç”Ÿæˆä¸€å®¶å…¨æ–°å…¬å¸ï¼Œçµ¦äºˆè¼ƒé«˜çš„åˆå§‹æ³¢å‹•ç‡ï¼Œä¸¦ç™¼å¸ƒã€Œæ–°è‚¡ä¸Šå¸‚ã€å…¬å‘Šï¼Œå¸å¼•è³‡é‡‘ç‚’ä½œã€‚

### 5. ğŸ’¸ è‚¡åˆ©åˆ†ç´… (Dividends)

*   **æ©Ÿåˆ¶**ï¼šæ¯ 10 åˆ†é˜ï¼ˆéŠæˆ²æ™‚é–“ï¼‰çµç®—ä¸€æ¬¡ã€‚
*   **è¨ˆç®—**ï¼šæ ¹æ“šå…¬å¸ç›ˆåˆ©èƒ½åŠ›éš¨æ©Ÿç™¼æ”¾è‚¡åˆ© (`Dividend Yield` ç´„ 1% ~ 5%)ã€‚
*   **è¢«å‹•æ”¶å…¥**ï¼šæŒæœ‰è‚¡ç¥¨çš„ç©å®¶æœƒè‡ªå‹•æ”¶åˆ°ç¾é‡‘å…¥å¸³ï¼Œé¼“å‹µé•·æœŸæŒæœ‰å„ªè³ªè‚¡ã€‚

### 6. ğŸ‡ çš‡å®¶è³½é¦¬å ´ (Royal Racecourse)

é€™æ˜¯ä¸€å€‹é«˜é¢¨éšªé«˜å›å ±çš„åšå¼ˆç³»çµ±ï¼Œè®“è³‡é‡‘æœ‰å¿«é€Ÿæµå‹•çš„å‡ºå£ã€‚

*   **æ¯”è³½é »ç‡**ï¼šæ¯ 10 åˆ†é˜ä¸€å ´ã€‚
*   **å‹ç‡èˆ‡è³ ç‡ (Odds & Win Rate)**ï¼š
    *   **"Fair" Odds (é«˜å›å ±è¨­å®š)**ï¼š
        *   ç³»çµ±å·²**ç§»é™¤**å‚³çµ±çš„èŠå®¶æŠ½æ°´æ©Ÿåˆ¶ (House Edge)ã€‚
        *   ç¾åœ¨è³ ç‡ç›´æ¥ç­‰æ–¼ `1 / å‹ç‡` (ä¾‹å¦‚å‹ç‡ 20% -> è³ ç‡ 5.0)ï¼Œä¸¦å¼·åˆ¶è¨­å®šæœ€ä½è³ ç‡ç‚º 1.05ã€‚
        *   é€™æ„å‘³è‘—é•·æœŸè€Œè¨€ RTP (ç©å®¶å›å ±ç‡) æ¥µé«˜ï¼Œç”šè‡³æ¥è¿‘ 100%ï¼Œæä¾›æœ€åˆºæ¿€çš„åšå¼ˆé«”é©—ã€‚
    *   **å‹•æ…‹æ‡²ç½° (Dynamic Penalty)**ï¼š
        *   é›–ç„¡å›ºå®šæŠ½æ°´ï¼Œä½†è¨­æœ‰ã€Œç†±é–€æ‡²ç½°ã€ã€‚ç•¶æŸåŒ¹é¦¬è¢«éåº¦é‡æ³¨ (è¶…éç¸½å½©æ±  30%)ï¼Œå…¶èƒ½åŠ›å€¼æœƒå—åˆ°è¼•å¾®æ‡²ç½° (Speed/Stamina ä¸‹é™)ã€‚
        *   é€™é˜²æ­¢äº† "å¿…å‹é¦¬" çš„å‡ºç¾ï¼Œç¶­æŒè³½äº‹çš„ä¸å¯é æ¸¬æ€§ã€‚
*   **å³æ™‚å‹•ç•«**ï¼šå‰ç«¯ä½¿ç”¨ Easing å‡½æ•¸èˆ‡æœ‰æ©Ÿå™ªè² (Organic Noise) æ¨¡æ“¬çœŸå¯¦è³½é¦¬å‹•æ…‹ï¼Œå† è»è¡ç·šæ™‚æœƒæœ‰æˆ²åŠ‡æ€§çš„è¶…è»Šæ•ˆæœã€‚

### 7. ğŸ° è³½åšè€è™æ©Ÿ (Cyber Slots)

å…¨æ–°çš„è³­å ´å°éŠæˆ²ï¼Œæä¾›æ›´å¿«é€Ÿçš„è³‡é‡‘è¼¸è´é«”é©—ã€‚

*   **è¦–è¦ºé¢¨æ ¼**ï¼šæ¡ Cyberpunk éœ“è™¹æ·±è‰²é¢¨æ ¼ï¼Œé…æœ‰è¯éº—çš„ CSS å‹•ç•«èˆ‡ç²’å­ä¸­çç‰¹æ•ˆã€‚
*   **éŠæˆ²æ©Ÿåˆ¶**ï¼š
    *   **é«˜è³ ç‡ç¬¦è™Ÿ**ï¼š7ï¸âƒ£, ğŸ’, ğŸ”” ç­‰ç¶“å…¸ç¬¦è™Ÿã€‚
    *   **ç‰¹æ®Šä¸­ç**ï¼šè§¸ç™¼ **Super Big Win (20x)** æ™‚ï¼Œæœƒè‡ªå‹•ç™¼å¸ƒã€Œå…¨æœå»£æ’­æ–°èã€ï¼Œè®“å…¨é«”ç©å®¶çŸ¥é“æœ‰äººè´å¾—å¤§çã€‚
    *   **åŠŸèƒ½**ï¼š
        *   **æ‰‹å‹•/è‡ªå‹•æ¨¡å¼**ï¼šæ”¯æ´å–®æ¬¡ä¸‹æ³¨èˆ‡ã€Œè‡ªå‹•è¨—ç®¡ (Auto Spin)ã€åŠŸèƒ½ï¼Œè®“ä½ æ›æ©Ÿä¹Ÿèƒ½æŒçºŒåˆ·çã€‚
        *   **å³æ™‚æˆ°ç¸¾**ï¼šä¸‹æ–¹å³æ™‚é¡¯ç¤ºæœ€è¿‘å…©ç­†ä¸­çç´€éŒ„èˆ‡æ™‚é–“ã€‚

---

## ğŸ’° ç©å®¶èˆ‡äº¤æ˜“ç³»çµ±

### 1. è³‡ç”¢è¨ˆç®—
*   **æ·¨å€¼ (Net Worth)** = ç¾é‡‘ (Balance) + è‚¡ç¥¨å¸‚å€¼ (Stock Value)ã€‚
*   **å³æ™‚æ›´æ–°**ï¼šå‰ç«¯é€é WebSocket æ¥æ”¶å³æ™‚å ±åƒ¹ï¼Œå‹•æ…‹è¨ˆç®—ç¸½è³‡ç”¢ï¼Œç„¡éœ€é »ç¹åˆ·æ–° APIã€‚
*   **è²¡å¯Œæ¦œ (Leaderboard)**ï¼šç³»çµ±å³æ™‚è¨ˆç®—æ‰€æœ‰ç©å®¶çš„æ·¨è³‡ç”¢ä¸¦é€²è¡Œæ’åï¼Œé¡¯ç¤ºå‰ 10 åå¯Œè±ªã€‚

### 2. äº¤æ˜“é™åˆ¶
*   **è²·å…¥**ï¼šé¤˜é¡ä¸è¶³æ™‚å›å‚³ 200 (é™„å¸¶ Error Status)ï¼Œå‰ç«¯é¡¯ç¤ºç´…è‰²è­¦å‘Šã€‚
*   **è³£å‡º**ï¼šæŒè‚¡ä¸è¶³æ™‚å›å‚³ 200 (é™„å¸¶ Error Status)ï¼Œå‰ç«¯é¡¯ç¤ºç´…è‰²è­¦å‘Šã€‚
*   **T+0**ï¼šç›®å‰è¨­å®šç‚ºå³æ™‚äº¤å‰²ï¼Œè²·å…¥å¾Œå¯ç«‹å³è³£å‡ºã€‚

### 3. ç”¨æˆ¶é«”é©—å„ªåŒ–
*   **è¨»å†Š/ç™»å…¥**ï¼š
    *   å˜—è©¦è¨»å†Šå·²å­˜åœ¨å¸³è™Ÿ -> å¼•å°å»ç™»å…¥ (200 OK)ã€‚
    *   å˜—è©¦ç™»å…¥ä¸å­˜åœ¨å¸³è™Ÿ -> å¼•å°å»è¨»å†Š (200 OK)ã€‚
    *   å¯†ç¢¼éŒ¯èª¤ -> å‹å–„æç¤º (200 OK)ã€‚
*   **è·‘é¦¬ç‡ˆ (Ticker)**ï¼š
    *   ç´…ç‡ˆğŸ”´ï¼šç³»çµ±æ–·ç·šä¸­ã€‚
    *   ç¶ ç‡ˆğŸŸ¢ï¼šç³»çµ±æ­£å¸¸ã€‚
    *   é»ƒå­—âš ï¸ï¼šé‡å¤§å¸‚å ´å¿«è¨Šã€‚
    *   **é€šçŸ¥é˜²é‡ (Deduplication)**ï¼šå‰ç«¯å¯¦ä½œäº† `useRef` ç´€éŒ„æœ€å¾Œä¸€æ¬¡äº‹ä»¶ IDï¼Œé˜²æ­¢å›  WebSocket é »ç¹æ›´æ–°å°è‡´åŒä¸€å‰‡æ–°èé‡è¤‡å½ˆå‡º Toast é€šçŸ¥ã€‚

---

## ğŸš€ éƒ¨ç½²èˆ‡åŸ·è¡Œ

### ç’°å¢ƒè®Šæ•¸ (.env)
```ini
GEMINI_API_KEY=your_key_here
DATABASE_URL=postgresql://user:password@postgres:5432/stock_sim
REDIS_URL=redis://redis:6379/0
```

### Docker å•Ÿå‹• (æ¨è–¦)
```bash
# åŒ…å« DB, Redis, Backend, Frontend
docker-compose up --build
```
- Frontend: `http://localhost:3002` (æˆ– NAS IP:3002)
- Backend API: å…§éƒ¨ä¸²æ¥ï¼Œå¤–éƒ¨ä¸å¯è¦‹ (é€é Nginx Proxy `/api`)

### ğŸ”„ å¦‚ä½•æ›´æ–°ç¨‹å¼ç¢¼ (ä¸å½±éŸ¿è³‡æ–™åº«)
ç”±æ–¼è³‡æ–™åº«ä½¿ç”¨ Docker Volume (`postgres_data`) æ›è¼‰ï¼Œ**é‡å»ºå®¹å™¨ä¸¦ä¸æœƒæ¸…é™¤è³‡æ–™**ã€‚
è‹¥æ‚¨ä¿®æ”¹äº†å‰ç«¯æˆ–å¾Œç«¯ç¨‹å¼ç¢¼ï¼Œåªéœ€å†æ¬¡åŸ·è¡Œï¼š
```bash
docker-compose up --build -d
```
ç³»çµ±æœƒè‡ªå‹•ï¼š
1. **ä¿ç•™** è³‡æ–™åº«è³‡æ–™ (è‚¡ç¥¨ã€ç”¨æˆ¶è³‡ç”¢)ã€‚
2. **é‡å»º** å¾Œç«¯èˆ‡å‰ç«¯é¡åƒ (å¥—ç”¨æ–°ç¨‹å¼ç¢¼)ã€‚
3. **é‡å•Ÿ** æœå‹™ã€‚

è‹¥åªè¦æ›´æ–°ç‰¹å®šæœå‹™ (ä¾‹å¦‚åªæ”¹äº†å‰ç«¯)ï¼š
```bash
docker-compose up --build -d frontend
```

### æœ¬åœ°é–‹ç™¼ (Local Dev)
```bash
# Backend
cd backend
uv run uvicorn main:app --reload --port 8080

# Frontend
cd frontend
npm run dev
# Access: http://localhost:3006
```

---

## ğŸ“‚ ç›®éŒ„çµæ§‹
- `backend/market.py`: å¸‚å ´æ ¸å¿ƒç‰©ç†å¼•æ“ã€‚
- `backend/ai_service.py`: Gemini AI ä¸²æ¥é‚è¼¯ã€‚
- `backend/trader.py`: äº¤æ˜“æ“åˆé‚è¼¯ã€‚
- `frontend/src/context/SocketContext.jsx`: WebSocket å³æ™‚é€£ç·šç®¡ç†ã€‚
- `frontend/src/components/charts/`: Kç·šåœ–çµ„ä»¶ (Wrapper for Lightweight-charts).
