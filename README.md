# ğŸ æ°´æœè­‰äº¤æ‰€ PRO (Fruit Stock Exchange System)

é€™æ˜¯ä¸€å€‹çµåˆ **AI ç”Ÿæˆå…§å®¹** èˆ‡ **å³æ™‚æ¨¡æ“¬å¸‚å ´** çš„è‚¡ç¥¨äº¤æ˜“éŠæˆ²ç³»çµ±ã€‚
ç³»çµ±é€éè¤‡é›œçš„æ¼”ç®—æ³•æ¨¡æ“¬çœŸå¯¦å¸‚å ´çš„æ³¢å‹•ï¼Œä¸¦åˆ©ç”¨ Google Gemini AI å‹•æ…‹ç”Ÿæˆè²¡ç¶“æ–°èã€å°ˆå®¶é æ¸¬èˆ‡æ–°å…¬å¸ IPOã€‚

---

## ğŸ› ï¸ æŠ€è¡“æ¶æ§‹ (Tech Stack)

### Backend (å¾Œç«¯)
- **Framework**: Python FastAPI (Async)
- **Database**: PostgreSQL (SQLModel ORM)
- **Cache / IPC**: Redis (ç”¨æ–¼ Pub/Sub å³æ™‚è¡Œæƒ…å»£æ’­)
- **AI**: Google Gemini Pro/Flash API
- **Scheduler**: APScheduler (è™•ç†é€±ä¸€ IPOã€å®šæ™‚ä»»å‹™)

### Frontend (å‰ç«¯)
- **Framework**: React 18 (Vite)
- **UI Lib**: TailwindCSS, Shadcn/UI, Lucide Icons
- **Charts**: Lightweight-Charts (TradingView)
- **State**: Context API + WebSocket (useSocket)

### DevOps
- **Docker**: å®Œæ•´å®¹å™¨åŒ–éƒ¨ç½² (Backend, Frontend-Nginx, Postgres, Redis)
- **Nginx**: åå‘ä»£ç†èˆ‡éœæ…‹è³‡æºæœå‹™

---

## âš™ï¸ æ ¸å¿ƒæ©Ÿåˆ¶è©³è§£ (Core Mechanics)


### 1. ğŸ“ˆ å¸‚å ´å¼•æ“ (Market Engine Mechanics)

ç³»çµ±é€éç‰©ç†æ¨¡æ“¬è¨ˆç®—æ¯ç§’çš„åƒ¹æ ¼è®Šå‹•ï¼Œå…¬å¼å¦‚ä¸‹ï¼š

> `Price Change % = RegimeMean + BrownianNoise + DynamicGravity + Impact + Sniper`
>
#### A. æ··æ²Œé«”åˆ¶ (Chaos Regimes)
å¸‚å ´æƒ…ç·’ä¸å†å–®ä¸€ï¼Œè€Œæ˜¯æœƒåœ¨å››ç¨®ç‹€æ…‹é–“éš¨æ©Ÿåˆ‡æ›ï¼š
*   **NORMAL (å¸¸æ…‹)**: éš¨æ©Ÿæ¼«æ­¥ï¼ŒåŸºæº–åƒ¹æ ¼å¾®å¹…æ¼‚ç§»ã€‚
*   **BOOM (ç‹‚ç‰›)**: æ³¢å‹•ç‡ 1.5xï¼Œå¸¶æœ‰å‘ä¸Šå‹•èƒ½ï¼Œå®¹æ˜“ç”¢ç”Ÿæ³¡æ²«ã€‚
*   **CRASH (å´©ç›¤)**: æ³¢å‹•ç‡ 2.0xï¼Œå¸¶æœ‰å¼·çƒˆå‘ä¸‹å‹•èƒ½ï¼Œè€ƒé©—å¿ƒè‡Ÿã€‚
*   **CHAOS (æ··æ²Œ)**: æ³¢å‹•ç‡ 4.0xï¼Œç„¡æ–¹å‘æ€§åŠ‡çƒˆéœ‡ç›ªï¼Œè³­å¾’å¤©å ‚ã€‚

#### B. å‹•æ…‹å¼•åŠ› (Dynamic Gravity)
èˆŠç‰ˆçš„ã€Œæ­»æ¿å›æ­¸ã€å·²è¢«ç§»é™¤ã€‚ç¾åœ¨çš„å¸‚å ´æ“æœ‰ã€Œç§»å‹•é‡å¿ƒã€ï¼š
*   **åŸºæº–æ¼‚ç§»**ï¼šç•¶è‚¡åƒ¹é•·æœŸç¶­æŒåœ¨é«˜æª”ï¼Œå¸‚å ´æœƒé€æ¼¸æ¥å—é€™æ˜¯ã€Œæ–°å¸¸æ…‹ã€ï¼Œé‡å¿ƒæœƒéš¨ä¹‹è·Ÿä¸Šã€‚
*   **éç·šæ€§æ‹‰å›**ï¼šåªæœ‰åœ¨ä¹–é›¢ç‡ (Deviation) æ¥µå¤§ (>20%) æ™‚ï¼Œæ‰æœƒè§¸ç™¼é¡¯è‘—çš„åå‘å¼•åŠ›ï¼›å¹³æ™‚è‚¡åƒ¹è‡ªç”±ç™¼å±•ã€‚

#### C. æ¿å¡Šå·®ç•°
*   **æ ¹è–é¡ (Root)**: ä¾ç„¶æ“æœ‰æœ€å¼·çš„ç©©å®šæ€§èˆ‡æŠ—è·Œå±¬æ€§ (Gravity * 2.0)ï¼Œé©åˆä½œç‚ºé¿éšªè³‡ç”¢ã€‚
*   **è‚‰é¡ (Meat)**: å°å¸‚å ´æƒ…ç·’æœ€æ•æ„Ÿï¼Œåœ¨ BULL/BEAR æ™‚æœŸæ³¢å‹•æœ€åŠ‡çƒˆã€‚

#### D. å°ˆå®¶èˆ‡ç‹™æ“Šæ‰‹ (Guru & Sniper)
*   **å°ˆå®¶æ¼‚ç§»**ï¼šæ¯ä½å°ˆå®¶çš„é æ¸¬æœƒçµ¦äºˆå¾®å¹…æ¨åŠ›ã€‚
*   **ç‹™æ“Šæ‰‹ (Sniper)**ï¼š**0.02%** æ©Ÿç‡è§¸ç™¼ã€Œèƒ–æ‰‹æŒ‡ã€ï¼Œç¬é–“é€ æˆ `Â±1%~2%` çš„é–ƒå´©æˆ–æš´æ¼²ã€‚

### 2. ğŸ¤– AI å°ˆå®¶é æ¸¬ç³»çµ± (Guru System)

*   **äº”å¤§æ€§æ ¼å°ˆå®¶**ï¼š
    *   ğŸº **è¯çˆ¾è¡—ä¹‹ç‹¼** (æ¿€é€²å¤šé ­)
    *   ğŸ”® **æ°´æ™¶çƒå©†å©†** (ç„å­¸ç©ºé ­)
    *   ğŸ¤– **AI é‡åŒ–æ©Ÿå™¨äºº** (æ•¸æ“šæµ)
    *   ğŸ‘´ **ç©©å¥è€ç‹** (ä¿å®ˆæ´¾)
    *   ğŸ”— **å€å¡Šéˆä¿¡ä»°è€…** (ç§‘æŠ€ç‹‚ç†±)
*   **è‡ªæˆ‘å¯¦ç¾é è¨€ (Self-Fulfilling Prophecy)**ï¼š
    *   ç•¶å°ˆå®¶ç™¼å¸ƒé æ¸¬ (Bull/Bear) æ™‚ï¼Œæœƒç”¢ç”Ÿå¾®å¹…çš„ã€Œå°ˆå®¶æ¼‚ç§» (Guru Drift)ã€åŠ›é“ï¼Œæ¨å‹•è‚¡åƒ¹å¾€é æ¸¬æ–¹å‘ç§»å‹•ã€‚
    *   **å‘½ä¸­çå‹µ**ï¼šè‹¥è‚¡åƒ¹çœŸçš„é”åˆ°ç›®æ¨™åƒ¹ï¼ŒAI æœƒç”Ÿæˆã€Œå°ˆå®¶ç¥æº–é è¨€ã€çš„æ–°èï¼Œä¸¦å°è‚¡åƒ¹é€ æˆäºŒæ¬¡è¡æ“Šã€‚

### 3. ğŸ“‰ ç ´ç”¢èˆ‡é‡çµ„ (Bankruptcy & Rebrand)

*   **è§¸ç™¼æ¢ä»¶**ï¼šç•¶è‚¡åƒ¹ä½æ–¼ **$0.05** æ™‚ï¼Œå…¬å¸å®£å‘Šç ´ç”¢ã€‚
*   **å¾Œæœ**ï¼š
    *   æ‰€æœ‰æŒæœ‰è©²è‚¡ç¥¨çš„ç©å®¶ï¼ŒæŒå€‰æ­¸é›¶ (å£ç´™)ã€‚
    *   **AI é‡çµ„**ï¼šç³»çµ±ç«‹å³å‘¼å« Gemini AIï¼Œç”Ÿæˆä¸€å®¶å…¨æ–°çš„å…¬å¸ (åç¨±ã€ä»£è™Ÿ)ï¼Œä¸¦åœ¨åŸåƒ¹ä½é™„è¿‘é‡æ–°ä¸Šå¸‚ (Re-IPO)ã€‚

### 4. ğŸ‰ æ–°è‚¡ä¸Šå¸‚ (Weekly IPO)

*   **è§¸ç™¼æ™‚é–“**ï¼šæ¯é€±ä¸€æ—©ä¸Š 9:00ã€‚
*   **æ©Ÿç‡**ï¼š5% æ©Ÿç‡è§¸ç™¼ã€‚
*   **æµç¨‹**ï¼šAI ç”Ÿæˆä¸€å®¶å…¨æ–°å…¬å¸ï¼Œçµ¦äºˆè¼ƒé«˜çš„åˆå§‹æ³¢å‹•ç‡ï¼Œä¸¦ç™¼å¸ƒã€Œæ–°è‚¡ä¸Šå¸‚ã€å…¬å‘Šï¼Œå¸å¼•è³‡é‡‘ç‚’ä½œã€‚

### 5. ğŸ’¸ è‚¡åˆ©åˆ†ç´… (Dividends)

*   **æ©Ÿåˆ¶**ï¼šæ¯ 10 åˆ†é˜ï¼ˆéŠæˆ²æ™‚é–“ï¼‰çµç®—ä¸€æ¬¡ã€‚
*   **è¨ˆç®—**ï¼šæ ¹æ“šå…¬å¸ç›ˆåˆ©èƒ½åŠ›éš¨æ©Ÿç™¼æ”¾è‚¡åˆ© (`Dividend Yield` ç´„ 1% ~ 5%)ã€‚
*   **è¢«å‹•æ”¶å…¥**ï¼šæŒæœ‰è‚¡ç¥¨çš„ç©å®¶æœƒè‡ªå‹•æ”¶åˆ°ç¾é‡‘å…¥å¸³ï¼Œé¼“å‹µé•·æœŸæŒæœ‰å„ªè³ªè‚¡ã€‚

### 6. ğŸ‡ çš‡å®¶è³½é¦¬å ´ (Royal Racecourse)

é€™æ˜¯ä¸€å€‹é«˜é¢¨éšªé«˜å›å ±çš„åšå¼ˆç³»çµ±ï¼Œè®“è³‡é‡‘æœ‰å¿«é€Ÿæµå‹•çš„å‡ºå£ã€‚

*   **æ¯”è³½é »ç‡**ï¼šæ¯ 10 åˆ†é˜ä¸€å ´ã€‚
*   **å‹ç‡èˆ‡è³ ç‡ (Odds & Win Rate)**ï¼š
    *   **å…¬å¹³è³ ç‡**ï¼šç³»çµ±ç§»é™¤äº†èŠå®¶æŠ½æ°´ï¼Œè³ ç‡ç›´æ¥åæ˜ å‹ç‡å€’æ•¸ (ä¾‹å¦‚å‹ç‡ 50% = è³ ç‡ 2.0)ã€‚é€™ä½¿å¾—è³ ç‡çœ‹èµ·ä¾†éå¸¸æœ‰å¸å¼•åŠ›ï¼Œèª˜ä½¿ç©å®¶ä¸‹æ³¨ã€‚
    *   **æ®ºå¤§è³ å° (Kill Logic / æ®ºè±¬ç›¤)**ï¼š
        *   ç³»çµ±å…§å»ºã€Œç‡Ÿæ”¶ä¿è­·æ©Ÿåˆ¶ã€ã€‚
        *   ç•¶æŸåŒ¹é¦¬çš„ç¸½ä¸‹æ³¨é‡‘é¡è¶…éå½©æ± çš„ **20%** æ™‚ï¼Œè©²é¦¬æœƒå—åˆ°ã€Œå¤§ç†±é–€æ‡²ç½°ã€ï¼Œå‹ç‡é¡¯è‘—é™ä½ã€‚
        *   **çµæœ**ï¼šå¤§çœ¾çœ‹å¥½çš„ç†±é–€é¦¬å¾€å¾€æœƒçˆ†å†·è½é¦¬ï¼Œè€Œç„¡äººå•æ´¥çš„å†·é–€é¦¬å‰‡ç¶“å¸¸å‹å‡ºï¼Œè®“ç³»çµ±èƒ½æœ‰æ•ˆå›æ”¶ç©å®¶è³‡é‡‘ã€‚
*   **å³æ™‚å‹•ç•«**ï¼šå‰ç«¯ä½¿ç”¨ Easing å‡½æ•¸èˆ‡æœ‰æ©Ÿå™ªè² (Organic Noise) æ¨¡æ“¬çœŸå¯¦è³½é¦¬å‹•æ…‹ï¼Œå† è»è¡ç·šæ™‚æœƒæœ‰æˆ²åŠ‡æ€§çš„è¶…è»Šæ•ˆæœã€‚

---

## ğŸ’° ç©å®¶èˆ‡äº¤æ˜“ç³»çµ±

### 1. è³‡ç”¢è¨ˆç®—
*   **æ·¨å€¼ (Net Worth)** = ç¾é‡‘ (Balance) + è‚¡ç¥¨å¸‚å€¼ (Stock Value)ã€‚
*   **å³æ™‚æ›´æ–°**ï¼šå‰ç«¯é€é WebSocket æ¥æ”¶å³æ™‚å ±åƒ¹ï¼Œå‹•æ…‹è¨ˆç®—ç¸½è³‡ç”¢ï¼Œç„¡éœ€é »ç¹åˆ·æ–° APIã€‚
*   **è²¡å¯Œæ¦œ (Leaderboard)**ï¼šç³»çµ±å³æ™‚è¨ˆç®—æ‰€æœ‰ç©å®¶çš„æ·¨è³‡ç”¢ä¸¦é€²è¡Œæ’åï¼Œé¡¯ç¤ºå‰ 10 åå¯Œè±ªã€‚

### 2. äº¤æ˜“é™åˆ¶
*   **è²·å…¥**ï¼šé¤˜é¡ä¸è¶³æ™‚å›å‚³ 200 (é™„å¸¶ Error Status)ï¼Œå‰ç«¯é¡¯ç¤ºç´…è‰²è­¦å‘Šã€‚
*   **è³£å‡º**ï¼šæŒè‚¡ä¸è¶³æ™‚å›å‚³ 200 (é™„å¸¶ Error Status)ï¼Œå‰ç«¯é¡¯ç¤ºç´…è‰²è­¦å‘Šã€‚
*   **T+0**ï¼šç›®å‰è¨­å®šç‚ºå³æ™‚äº¤å‰²ï¼Œè²·å…¥å¾Œå¯ç«‹å³è³£å‡ºã€‚

### 3. ç”¨æˆ¶é«”é©—å„ªåŒ–
*   **è¨»å†Š/ç™»å…¥**ï¼š
    *   å˜—è©¦è¨»å†Šå·²å­˜åœ¨å¸³è™Ÿ -> å¼•å°å»ç™»å…¥ (200 OK)ã€‚
    *   å˜—è©¦ç™»å…¥ä¸å­˜åœ¨å¸³è™Ÿ -> å¼•å°å»è¨»å†Š (200 OK)ã€‚
    *   å¯†ç¢¼éŒ¯èª¤ -> å‹å–„æç¤º (200 OK)ã€‚
*   **è·‘é¦¬ç‡ˆ (Ticker)**ï¼š
    *   ç´…ç‡ˆğŸ”´ï¼šç³»çµ±æ–·ç·šä¸­ã€‚
    *   ç¶ ç‡ˆğŸŸ¢ï¼šç³»çµ±æ­£å¸¸ã€‚
    *   é»ƒå­—âš ï¸ï¼šé‡å¤§å¸‚å ´å¿«è¨Šã€‚
    *   **é€šçŸ¥é˜²é‡ (Deduplication)**ï¼šå‰ç«¯å¯¦ä½œäº† `useRef` ç´€éŒ„æœ€å¾Œä¸€æ¬¡äº‹ä»¶ IDï¼Œé˜²æ­¢å›  WebSocket é »ç¹æ›´æ–°å°è‡´åŒä¸€å‰‡æ–°èé‡è¤‡å½ˆå‡º Toast é€šçŸ¥ã€‚

---

## ğŸš€ éƒ¨ç½²èˆ‡åŸ·è¡Œ

### ç’°å¢ƒè®Šæ•¸ (.env)
```ini
GEMINI_API_KEY=your_key_here
DATABASE_URL=postgresql://user:password@postgres:5432/stock_sim
REDIS_URL=redis://redis:6379/0
```

### Docker å•Ÿå‹• (æ¨è–¦)
```bash
# åŒ…å« DB, Redis, Backend, Frontend
docker-compose up --build
```
- Frontend: `http://localhost:3002` (æˆ– NAS IP:3002)
- Backend API: å…§éƒ¨ä¸²æ¥ï¼Œå¤–éƒ¨ä¸å¯è¦‹ (é€é Nginx Proxy `/api`)

### ğŸ”„ å¦‚ä½•æ›´æ–°ç¨‹å¼ç¢¼ (ä¸å½±éŸ¿è³‡æ–™åº«)
ç”±æ–¼è³‡æ–™åº«ä½¿ç”¨ Docker Volume (`postgres_data`) æ›è¼‰ï¼Œ**é‡å»ºå®¹å™¨ä¸¦ä¸æœƒæ¸…é™¤è³‡æ–™**ã€‚
è‹¥æ‚¨ä¿®æ”¹äº†å‰ç«¯æˆ–å¾Œç«¯ç¨‹å¼ç¢¼ï¼Œåªéœ€å†æ¬¡åŸ·è¡Œï¼š
```bash
docker-compose up --build -d
```
ç³»çµ±æœƒè‡ªå‹•ï¼š
1. **ä¿ç•™** è³‡æ–™åº«è³‡æ–™ (è‚¡ç¥¨ã€ç”¨æˆ¶è³‡ç”¢)ã€‚
2. **é‡å»º** å¾Œç«¯èˆ‡å‰ç«¯é¡åƒ (å¥—ç”¨æ–°ç¨‹å¼ç¢¼)ã€‚
3. **é‡å•Ÿ** æœå‹™ã€‚

è‹¥åªè¦æ›´æ–°ç‰¹å®šæœå‹™ (ä¾‹å¦‚åªæ”¹äº†å‰ç«¯)ï¼š
```bash
docker-compose up --build -d frontend
```

### æœ¬åœ°é–‹ç™¼ (Local Dev)
```bash
# Backend
cd backend
uv run uvicorn main:app --reload --port 8080

# Frontend
cd frontend
npm run dev
# Access: http://localhost:3006
```

---

## ğŸ“‚ ç›®éŒ„çµæ§‹
- `backend/market.py`: å¸‚å ´æ ¸å¿ƒç‰©ç†å¼•æ“ã€‚
- `backend/ai_service.py`: Gemini AI ä¸²æ¥é‚è¼¯ã€‚
- `backend/trader.py`: äº¤æ˜“æ“åˆé‚è¼¯ã€‚
- `frontend/src/context/SocketContext.jsx`: WebSocket å³æ™‚é€£ç·šç®¡ç†ã€‚
- `frontend/src/components/charts/`: Kç·šåœ–çµ„ä»¶ (Wrapper for Lightweight-charts).
